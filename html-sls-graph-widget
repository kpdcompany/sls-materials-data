<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        .sls-chart-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .chart-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .chart-header h2 {
            font-size: 28px;
            color: #333;
            margin-bottom: 10px;
        }
        .chart-header p {
            color: #666;
            font-size: 16px;
        }
        .chart-wrapper {
            position: relative;
            height: 700px;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        canvas {
            max-height: 650px !important;
        }
        .material-toggles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        .toggle-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        .toggle-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .toggle-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin-right: 10px;
        }
        .toggle-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .toggle-label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            text-align: center;
            padding: 40px;
            color: #d32f2f;
            background: #ffebee;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="sls-chart-container">
        <div class="chart-header">
            <h2>SLS Material Properties Comparison</h2>
            <p>Interactive comparison of mechanical properties across different materials</p>
        </div>

        <div id="loadingMessage" class="loading">Loading materials data...</div>
        <div id="errorMessage" class="error" style="display: none;"></div>

        <div class="chart-wrapper" style="display: none;" id="chartContainer">
            <canvas id="materialsChart"></canvas>
        </div>

        <div class="material-toggles" id="materialToggles" style="display: none;"></div>
    </div>

    <script>
        // GitHub data source
        var GITHUB_DATA_URL = 'https://raw.githubusercontent.com/kpdcompany/sls-materials-data/refs/heads/main/materials-data.json';

        var chart = null;
        var materialsData = null;
        var enabledMaterials = {};

        function hexToRgba(hex, alpha) {
            var r = parseInt(hex.slice(1, 3), 16);
            var g = parseInt(hex.slice(3, 5), 16);
            var b = parseInt(hex.slice(5, 7), 16);
            return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + alpha + ')';
        }

        function normalizeData() {
            var maxValues = materialsData.maxValues;
            var normalized = [];
            
            for (var i = 0; i < materialsData.materials.length; i++) {
                var material = materialsData.materials[i];
                if (!enabledMaterials[material.name]) continue;
                
                var normalizedData = [];
                for (var j = 0; j < material.data.length; j++) {
                    normalizedData[j] = (material.data[j] / maxValues[j]) * 100;
                }
                
                normalized.push({
                    name: material.name,
                    color: material.color,
                    data: normalizedData,
                    original: material.data
                });
            }
            return normalized;
        }

        function createChart() {
            if (!materialsData) return;

            var ctx = document.getElementById('materialsChart').getContext('2d');
            var labels = materialsData.properties;
            var tooltipLabels = [
                'Tensile Strength',
                'Tensile Modulus',
                'Elongation',
                'Flexural Modulus',
                'Flexural Strength',
                'HDT @ 0.45 MPa',
                'Izod Impact Strength'
            ];
            var units = materialsData.units;
            var maxValues = materialsData.maxValues;
            
            var normalizedMats = normalizeData();
            var datasets = [];
            
            for (var i = 0; i < normalizedMats.length; i++) {
                var mat = normalizedMats[i];
                datasets.push({
                    label: mat.name,
                    data: mat.data,
                    backgroundColor: hexToRgba(mat.color, 0.6),
                    borderColor: mat.color,
                    borderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    original: mat.original
                });
            }

            var maxValuePlugin = {
                id: 'maxValueLabels',
                afterDatasetsDraw: function(chart) {
                    var ctx = chart.ctx;
                    var scale = chart.scales.r;
                    
                    ctx.save();
                    ctx.font = '11px Arial';
                    ctx.fillStyle = '#666';
                    
                    for (var i = 0; i < labels.length; i++) {
                        var angle = scale.getIndexAngle(i) - Math.PI / 2;
                        var radius = scale.getDistanceFromCenterForValue(100);
                        
                        var x = scale.xCenter + Math.cos(angle) * radius;
                        var y = scale.yCenter + Math.sin(angle) * radius;
                        
                        var offsetX = Math.cos(angle) * 20;
                        var offsetY = Math.sin(angle) * 20;
                        
                        var labelX = x + offsetX;
                        var labelY = y + offsetY;
                        
                        ctx.beginPath();
                        ctx.strokeStyle = '#ccc';
                        ctx.lineWidth = 1;
                        ctx.moveTo(x, y);
                        ctx.lineTo(labelX, labelY);
                        ctx.stroke();
                        
                        ctx.fillStyle = '#333';
                        ctx.font = 'bold 11px Arial';
                        
                        var textAlign = 'left';
                        var textX = labelX + 5;
                        if (angle > Math.PI / 2 || angle < -Math.PI / 2) {
                            textAlign = 'right';
                            textX = labelX - 5;
                        }
                        ctx.textAlign = textAlign;
                        ctx.fillText(maxValues[i], textX, labelY + 4);
                    }
                    ctx.restore();
                }
            };

            if (chart) chart.destroy();
            
            chart = new Chart(ctx, {
                type: 'radar',
                data: { labels: labels, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'top',
                            labels: { 
                                padding: 15,
                                font: { size: 13, weight: '600' },
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(ctx) {
                                    return tooltipLabels[ctx[0].dataIndex];
                                },
                                label: function(ctx) {
                                    var matName = ctx.dataset.label;
                                    var origValue = ctx.dataset.original[ctx.dataIndex];
                                    var unit = units[ctx.dataIndex];
                                    return matName + ': ' + origValue + unit;
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            suggestedMin: 0,
                            suggestedMax: 100,
                            angleLines: { color: '#e0e0e0' },
                            grid: { color: '#f0f0f0' },
                            pointLabels: {
                                font: { size: 10, weight: '600' },
                                color: '#333',
                                padding: function(context) {
                                    return context.index === 5 ? 60 : 45;
                                }
                            },
                            ticks: {
                                backdropColor: 'transparent',
                                display: false
                            }
                        }
                    }
                },
                plugins: [maxValuePlugin]
            });
        }

        function createToggles() {
            var container = document.getElementById('materialToggles');
            container.innerHTML = '';
            
            for (var i = 0; i < materialsData.materials.length; i++) {
                var material = materialsData.materials[i];
                
                var toggleDiv = document.createElement('div');
                toggleDiv.className = 'toggle-item';
                
                var checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = 'toggle-' + i;
                checkbox.checked = enabledMaterials[material.name];
                checkbox.onchange = (function(name) {
                    return function() {
                        enabledMaterials[name] = this.checked;
                        createChart();
                    };
                })(material.name);
                
                var colorDiv = document.createElement('div');
                colorDiv.className = 'toggle-color';
                colorDiv.style.backgroundColor = material.color;
                
                var label = document.createElement('label');
                label.className = 'toggle-label';
                label.setAttribute('for', 'toggle-' + i);
                label.textContent = material.name;
                label.style.cursor = 'pointer';
                
                toggleDiv.appendChild(checkbox);
                toggleDiv.appendChild(colorDiv);
                toggleDiv.appendChild(label);
                
                toggleDiv.onclick = function(e) {
                    if (e.target.tagName !== 'INPUT') {
                        var cb = this.querySelector('input[type="checkbox"]');
                        cb.checked = !cb.checked;
                        cb.onchange();
                    }
                };
                
                container.appendChild(toggleDiv);
            }
        }

        function loadMaterialsData() {
            fetch(GITHUB_DATA_URL)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load materials data. Status: ' + response.status);
                    }
                    return response.json();
                })
                .then(function(data) {
                    materialsData = data;
                    
                    for (var i = 0; i < data.materials.length; i++) {
                        enabledMaterials[data.materials[i].name] = data.materials[i].enabled;
                    }
                    
                    document.getElementById('loadingMessage').style.display = 'none';
                    document.getElementById('chartContainer').style.display = 'block';
                    document.getElementById('materialToggles').style.display = 'grid';
                    
                    createChart();
                    createToggles();
                })
                .catch(function(error) {
                    document.getElementById('loadingMessage').style.display = 'none';
                    var errorMsg = document.getElementById('errorMessage');
                    errorMsg.textContent = 'Error loading materials data: ' + error.message + '. Please check the GitHub URL configuration.';
                    errorMsg.style.display = 'block';
                    console.error('Error:', error);
                });
        }

        loadMaterialsData();
    </script>
</body>
</html>
